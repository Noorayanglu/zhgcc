import{m as e,n as a}from"./user-5587e42e.js";import{j as l}from"./index-110bbcb5.js";import{f as r}from"./feedback-5363c0cc.js";import{i as t}from"./echarts-84a2ba7b.js";import{_ as o}from"./index-6dbce3d0.js";import{i as s,f as m,z as n,e as d,o as u,c as p,a as i,d as c,Z as f,ag as w,U as b,O as h,S as v,F as g,a7 as _,u as x,az as V,aA as y}from"./@vue-c5a747fc.js";import"./index-be79eb97.js";import"./lodash-20cd73ca.js";import"./dayjs-9ee440cb.js";import"./axios-5b55c11d.js";import"./element-plus-230cec57.js";import"./lodash-es-fb3d0246.js";import"./@vueuse-90035fc5.js";import"./@element-plus-388117bf.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./escape-html-92a447fa.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-9ca8b935.js";import"./zrender-1465eda9.js";import"./vue-router-641e505b.js";import"./pinia-801b3705.js";/* empty css                    */const E={class:"echarts-box"},k=o({__name:"setPower",props:{chartseries:{type:Array,default:[]}},setup(e){const a=e;s((()=>{o()})),m((()=>a.chartseries),(()=>{r&&r.dispose(),o()}),{deep:!0}),n((()=>{r&&r.dispose()}));const l=d();let r;function o(){r=t(l.value);const e={title:{text:"功率曲线（正值：充电；负值：放电）",textStyle:{fontSize:14,fontWeight:400},top:"10px",left:"center"},tooltip:{trigger:"axis",title:"功率曲线",axisPointer:{type:"line"},backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgba(0,0,0,0.5)",textStyle:{color:"#fff"}},legend:{textStyle:{}},grid:{top:"13%",left:"3%",right:"3%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,axisTick:{show:!1},axisLabel:{},axisLine:{},data:""},yAxis:{type:"value",axisLine:{show:!0,lineStyle:{}},axisPointer:{type:"none"}},series:[{type:"line",showSymbol:!1,data:a.chartseries}]};r.setOption(e)}return(e,a)=>(u(),p("div",E,[i("div",{ref_key:"myEcharts",ref:l,style:{width:"100%",height:"100%"}},null,512)]))}},[["__scopeId","data-v-d86a0184"]]),C=e=>(V("data-v-91890e40"),e=e(),y(),e),j={class:"setup"},S={class:"tab-box"},U=C((()=>i("div",{class:"card-header"},[i("span",null,"控制")],-1))),T={class:"newpower-box"},R={class:"newpower-box"},z={class:"newpower-box"},P={class:"newpower-box"},N={class:"newpower-box"},I={class:"newpower-box"},A={class:"newpower-box"},L={class:"newpower-box"},O={class:"newpower-box"},W={class:"newpower-box"},F={class:"newpower-box"},G={class:"newpower-box"},M=C((()=>i("div",{class:"card-header"},[i("span",null,"功率曲线设置")],-1))),D={class:"card-con"},K=C((()=>i("div",{class:"power-name time-text-margin"},"时间",-1))),Z=C((()=>i("div",{class:"power-name power-text-margin"},"功率值（KW）",-1))),q={class:"setvalue-value"},B=C((()=>i("template",{slot:"append"},[v("kW")],-1))),H={class:"setpowerbtn"},J={class:"power-box"},Q={class:"power-box-box"},X=o(c({__name:"Index",setup(t){const o=d([]),m=d({}),n=d([]),c=d([]),V=d([]),y=d(15);d("");let E=f([{chargeP:"",startTime:"",endTime:""}]);const C=d(),X=f({param:""}),Y=d(),$=f({param:null}),ee=d(),ae=f({param:null}),le=d(),re=f({param:null}),te=d(),oe=f({param:null}),se=d(),me=f({param:null}),ne=d(),de=f({param:null}),ue=d(),pe=f({param:null}),ie=d(),ce=f({param:null}),fe=d(),we=f({param:null}),be=d(),he=f({param:null}),ve=d(),ge=f({param:null});s((async()=>{c.value=await Ce(y.value),await Se()}));const _e=()=>{Ee(c.value,n.value)},xe=()=>{Ve().then((e=>{if(e){ye((e=>{let a=e,l=n.value.reduce(((e,a,l)=>(e[l+1]=a,e)),{});for(let r in a)"false"===a[r]&&(a[r]=l[r]),a[r]=Number(a[r]);return a})(e))}})).catch((e=>{}))},Ve=()=>new Promise(((e,a)=>{let l=E.map(((e,a)=>[e.startTime,e.endTime]));if(E.some((e=>""===e.chargeP||""===e.startTime||""===e.endTime)))return r.msgError("功率值与时间不能为空"),void a(new Error("功率值与时间不能为空"));if(ze(l))return r.msgError("时间段有重复"),void a(new Error("时间段有重复"));let t=Te(E);t.forEach((e=>{"00:00"===e.endTime&&(e.endTime="24:00")})),e(Ue(t).reduce(((e,a,l)=>(e[l+1]=a.chargeP,e)),{}))})),ye=e=>{let l={cmd:2,...e};a(l).then((e=>{e?r.msgSuccess("操作成功"):r.msgError("操作失败"),Se()})).catch((e=>{r.msgError("操作失败")}))},Ee=async(e,a)=>{let l=await ke(e,a),r=l.map((e=>e.name)),t=l.map((e=>e.value));V.value=r.map(((e,a)=>[e,t[a]]))},ke=(e,a)=>{const l=e.map(((e,l)=>({name:e,value:a[l]})));let r=[];return r.push(l[0]),l.reduce(((e,a)=>{let l=null;return e.value!==a.value&&(l={name:a.name,value:e.value}),l?r.push(l,a):r.push(a),a})),r},Ce=e=>{let a=60*e,l=86400/a,r=0,t=[];for(let o=0;o<l;o++){let e=parseInt(r/3600),l=parseInt(r%3600/60);t.push(je(e)+":"+je(l)),r+=a}return t},je=e=>e<10?"0"+e:e,Se=()=>{e().then((e=>{let a=e;m.value={"序列号":a["序列号"],"充电截止电芯电压":a["充电截止电芯电压"],"放电截止电芯电压":a["放电截止电芯电压"],"充电关口限制":a["充电关口限制"],"放电关口限制":a["放电关口限制"],"充电变压器限制":a["充电变压器限制"],"放电变压器限制":a["放电变压器限制"],"Cloud 用户名":a["Cloud用户名"],"Cloud 密码":a["Cloud密码"],"Cloud Url":a["Cloud Url"],"数据保留天数":a["数据保留天数"]},o.value=l(m.value);const{"序列号":r,"充电截止电芯电压":t,"放电截止电芯电压":s,"充电关口限制":d,"放电关口限制":u,"充电变压器限制":p,"放电变压器限制":i,"Cloud用户名":f,"Cloud密码":w,"Cloud Url":b,"数据保留天数":h,...v}=a;n.value=Object.values(v),Ee(c.value,n.value)})).catch((e=>{}))},Ue=e=>{let a=[];for(let l=0;l<1440;l+=15){const r="".concat(String(Math.floor(l/60)).padStart(2,"0"),":").concat(String(l%60).padStart(2,"0"));let t="false";for(const a of e){const e=Re(a.startTime),r=Re(a.endTime);if(l>=e&&l<r){t=a.chargeP;break}}a.push({time:r,chargeP:t})}return a},Te=e=>(e.sort(((e,a)=>{const l=Re(e.startTime),r=Re(e.endTime),t=Re(a.startTime),o=Re(a.endTime);return l!==t?l-t:r-o})),e),Re=e=>{const[a,l]=e.split(":").map(Number);return 60*a+l},ze=e=>{const a=new Set;for(const[l,r]of e)for(let e=l;e<r;e=Pe(e,1)){if(a.has(e))return!0;a.add(e)}return!1},Pe=(e,a)=>{const[l,r]=e.split(":").map(Number);let t=l+Math.floor((r+a)/60),o=(r+a)%60;return 60===o&&(o=0,t+=1),"".concat(String(t).padStart(2,"0"),":").concat(String(o).padStart(2,"0"))};return(e,l)=>{const t=w("el-table-column"),s=w("el-table"),m=w("el-col"),n=w("el-input"),d=w("el-button"),c=w("el-form-item"),f=w("el-form"),y=w("el-card"),Ve=w("el-row"),ye=w("el-time-select");return u(),p("div",j,[i("div",null,[b(Ve,null,{default:h((()=>[b(m,{xs:24,sm:12,class:"col-box"},{default:h((()=>[i("div",S,[b(s,{data:o.value,stripe:"",border:"",align:"center",style:{width:"100%"}},{default:h((()=>[b(t,{type:"index",width:"60",align:"center",label:"序号"}),b(t,{prop:"name",label:"数据名称",align:"center"}),b(t,{prop:"value",label:"数值",align:"center"}),b(t,{prop:"unit",label:"单位",align:"center",width:"60"})])),_:1},8,["data"])])])),_:1}),b(m,{xs:24,sm:12},{default:h((()=>[b(y,{class:"box-card tabline"},{header:h((()=>[U])),default:h((()=>[i("div",null,[b(f,{ref_key:"formRef0",ref:C,model:X,"label-width":"50"},{default:h((()=>[b(c,{label:"",prop:"param"},{default:h((()=>[i("div",T,[b(n,{modelValue:X.param,"onUpdate:modelValue":l[0]||(l[0]=e=>X.param=e),class:"newpower-input",placeholder:"序列号"},null,8,["modelValue"]),b(d,{class:"newpower-btn",onClick:l[1]||(l[1]=e=>(e=>{if(!e)return;if(""===X.param)return void r.msgError("请输入序列号");let l={cmd:100,param:X.param};a(l).then((e=>{e?r.msgSuccess("操作成功"):r.msgError("操作失败"),Se()})).catch((e=>{r.msgError("操作失败")}))})(C.value))},{default:h((()=>[v("设置")])),_:1})])])),_:1})])),_:1},8,["model"]),b(f,{ref_key:"formRef",ref:Y,model:$,"label-width":"50"},{default:h((()=>[b(c,{label:"",prop:"param"},{default:h((()=>[i("div",R,[b(n,{modelValue:$.param,"onUpdate:modelValue":l[2]||(l[2]=e=>$.param=e),type:"number",class:"newpower-input",placeholder:"充电截止电芯电压"},null,8,["modelValue"]),b(d,{class:"newpower-btn",onClick:l[3]||(l[3]=e=>(e=>{if(!e)return;if(null===$.param)return void r.msgError("请输入充电截止电芯电压");let l={cmd:0,param:1e3*Number($.param)};a(l).then((e=>{e?r.msgSuccess("操作成功"):r.msgError("操作失败"),Se()})).catch((e=>{r.msgError("操作失败")}))})(Y.value))},{default:h((()=>[v("设置")])),_:1})])])),_:1})])),_:1},8,["model"]),b(f,{ref_key:"formRef1",ref:ee,model:ae,"label-width":"50"},{default:h((()=>[b(c,{label:"",prop:"param"},{default:h((()=>[i("div",z,[b(n,{modelValue:ae.param,"onUpdate:modelValue":l[4]||(l[4]=e=>ae.param=e),type:"number",class:"newpower-input",placeholder:"放电截止电芯电压"},null,8,["modelValue"]),b(d,{class:"newpower-btn",onClick:l[5]||(l[5]=e=>(e=>{if(!e)return;if(null===ae.param)return void r.msgError("请输入放电截止电芯电压");let l={cmd:1,param:1e3*Number(ae.param)};a(l).then((e=>{e?r.msgSuccess("操作成功"):r.msgError("操作失败"),Se()})).catch((e=>{r.msgError("操作失败")}))})(ee.value))},{default:h((()=>[v("设置")])),_:1})])])),_:1})])),_:1},8,["model"]),b(f,{ref_key:"formRef2",ref:le,model:re,"label-width":"50"},{default:h((()=>[b(c,{label:"",prop:"param"},{default:h((()=>[i("div",P,[b(n,{modelValue:re.param,"onUpdate:modelValue":l[6]||(l[6]=e=>re.param=e),type:"number",class:"newpower-input",placeholder:"充电关口限制"},null,8,["modelValue"]),b(d,{class:"newpower-btn",onClick:l[7]||(l[7]=e=>(e=>{if(!e)return;if(null===re.param)return void r.msgError("请输入充电关口限制");let l={cmd:3,param:Number(re.param)};a(l).then((e=>{e?r.msgSuccess("操作成功"):r.msgError("操作失败"),Se()})).catch((e=>{r.msgError("操作失败")}))})(le.value))},{default:h((()=>[v("设置")])),_:1})])])),_:1})])),_:1},8,["model"]),b(f,{ref_key:"formRef3",ref:te,model:oe,"label-width":"50"},{default:h((()=>[b(c,{label:"",prop:"param"},{default:h((()=>[i("div",N,[b(n,{modelValue:oe.param,"onUpdate:modelValue":l[8]||(l[8]=e=>oe.param=e),type:"number",class:"newpower-input",placeholder:"放电关口限制"},null,8,["modelValue"]),b(d,{class:"newpower-btn",onClick:l[9]||(l[9]=e=>(e=>{if(!e)return;if(null===oe.param)return void r.msgError("请输入放电关口限制");let l={cmd:5,param:Number(oe.param)};a(l).then((e=>{e?r.msgSuccess("操作成功"):r.msgError("操作失败"),Se()})).catch((e=>{r.msgError("操作失败")}))})(te.value))},{default:h((()=>[v("设置")])),_:1})])])),_:1})])),_:1},8,["model"]),b(f,{ref_key:"formRef4",ref:se,model:me,"label-width":"50"},{default:h((()=>[b(c,{label:"",prop:"param"},{default:h((()=>[i("div",I,[b(n,{modelValue:me.param,"onUpdate:modelValue":l[10]||(l[10]=e=>me.param=e),type:"number",class:"newpower-input",placeholder:"充电变压器限制"},null,8,["modelValue"]),b(d,{class:"newpower-btn",onClick:l[11]||(l[11]=e=>(e=>{if(!e)return;if(null===me.param)return void r.msgError("请输入充电变压器限制");let l={cmd:4,param:Number(me.param)};a(l).then((e=>{e?r.msgSuccess("操作成功"):r.msgError("操作失败"),Se()})).catch((e=>{r.msgError("操作失败")}))})(se.value))},{default:h((()=>[v("设置")])),_:1})])])),_:1})])),_:1},8,["model"]),b(f,{ref_key:"formRef5",ref:ne,model:de,"label-width":"50"},{default:h((()=>[b(c,{label:"",prop:"param"},{default:h((()=>[i("div",A,[b(n,{modelValue:de.param,"onUpdate:modelValue":l[12]||(l[12]=e=>de.param=e),type:"number",class:"newpower-input",placeholder:"放电变压器限制"},null,8,["modelValue"]),b(d,{class:"newpower-btn",onClick:l[13]||(l[13]=e=>(e=>{if(!e)return;if(null===de.param)return void r.msgError("请输入放电变压器限制");let l={cmd:6,param:Number(de.param)};a(l).then((e=>{e?r.msgSuccess("操作成功"):r.msgError("操作失败"),Se()})).catch((e=>{r.msgError("操作失败")}))})(ne.value))},{default:h((()=>[v("设置")])),_:1})])])),_:1})])),_:1},8,["model"]),b(f,{ref_key:"formRef6",ref:ue,model:pe,"label-width":"50"},{default:h((()=>[b(c,{label:"",prop:"param"},{default:h((()=>[i("div",L,[b(n,{modelValue:pe.param,"onUpdate:modelValue":l[14]||(l[14]=e=>pe.param=e),class:"newpower-input",placeholder:"Cloud 用户名"},null,8,["modelValue"]),b(d,{class:"newpower-btn",onClick:l[15]||(l[15]=e=>(e=>{if(!e)return;if(null===pe.param)return void r.msgError("请输入Cloud 用户名");let l={cmd:101,param:pe.param};a(l).then((e=>{e?r.msgSuccess("操作成功"):r.msgError("操作失败"),Se()})).catch((e=>{r.msgError("操作失败")}))})(ue.value))},{default:h((()=>[v("设置")])),_:1})])])),_:1})])),_:1},8,["model"]),b(f,{ref_key:"formRef7",ref:ie,model:ce,"label-width":"50"},{default:h((()=>[b(c,{label:"",prop:"param"},{default:h((()=>[i("div",O,[b(n,{modelValue:ce.param,"onUpdate:modelValue":l[16]||(l[16]=e=>ce.param=e),class:"newpower-input",placeholder:"Cloud 密码"},null,8,["modelValue"]),b(d,{class:"newpower-btn",onClick:l[17]||(l[17]=e=>(e=>{if(!e)return;if(null===ce.param)return void r.msgError("请输入Cloud 密码");let l={cmd:102,param:ce.param};a(l).then((e=>{e?r.msgSuccess("操作成功"):r.msgError("操作失败"),Se()})).catch((e=>{r.msgError("操作失败")}))})(ie.value))},{default:h((()=>[v("设置")])),_:1})])])),_:1})])),_:1},8,["model"]),b(f,{ref_key:"formRef8",ref:fe,model:we,"label-width":"50"},{default:h((()=>[b(c,{label:"",prop:"param"},{default:h((()=>[i("div",W,[b(n,{modelValue:we.param,"onUpdate:modelValue":l[18]||(l[18]=e=>we.param=e),class:"newpower-input",placeholder:"Cloud Url"},null,8,["modelValue"]),b(d,{class:"newpower-btn",onClick:l[19]||(l[19]=e=>(e=>{if(!e)return;if(null===we.param)return void r.msgError("请输入Cloud Url");let l={cmd:103,param:we.param};a(l).then((e=>{e?r.msgSuccess("操作成功"):r.msgError("操作失败"),Se()})).catch((e=>{r.msgError("操作失败")}))})(fe.value))},{default:h((()=>[v("设置")])),_:1})])])),_:1})])),_:1},8,["model"]),b(f,{ref_key:"formRef12",ref:ve,model:ge,"label-width":"50"},{default:h((()=>[b(c,{label:"",prop:"param"},{default:h((()=>[i("div",F,[b(n,{modelValue:ge.param,"onUpdate:modelValue":l[20]||(l[20]=e=>ge.param=e),type:"number",class:"newpower-input",placeholder:"数据保留天数"},null,8,["modelValue"]),b(d,{class:"newpower-btn",onClick:l[21]||(l[21]=e=>(e=>{if(!e)return;if(null===ge.param)return void r.msgError("请输入数据保留天数");let l={cmd:200,param:Number(ge.param)};a(l).then((e=>{e?r.msgSuccess("操作成功"):r.msgError("操作失败"),Se()})).catch((e=>{r.msgError("操作失败")}))})(ve.value))},{default:h((()=>[v("设置")])),_:1})])])),_:1})])),_:1},8,["model"]),b(f,{ref_key:"formRef9",ref:be,model:he,"label-width":"50"},{default:h((()=>[b(c,{label:"",prop:"param"},{default:h((()=>[i("div",G,[b(d,{class:"newpower-btn",onClick:l[22]||(l[22]=e=>(e=>{if(!e)return;a({cmd:104,param:0}).then((e=>{e?r.msgSuccess("操作成功"):r.msgError("操作失败"),Se()})).catch((e=>{r.msgError("操作失败")}))})(be.value))},{default:h((()=>[v("Cloud 注册")])),_:1})])])),_:1})])),_:1},8,["model"])])])),_:1})])),_:1}),b(m,{span:24,class:"power-card"},{default:h((()=>[b(y,{class:"box-card"},{header:h((()=>[M])),default:h((()=>[i("div",D,[b(Ve,null,{default:h((()=>[b(m,{span:16},{default:h((()=>[K])),_:1}),b(m,{span:8},{default:h((()=>[Z])),_:1})])),_:1}),(u(!0),p(g,null,_(x(E),((e,a)=>(u(),p("div",{key:a},[i("div",q,[b(Ve,null,{default:h((()=>[b(m,{span:16,class:"col-box-time"},{default:h((()=>[b(ye,{modelValue:e.startTime,"onUpdate:modelValue":a=>e.startTime=a,"max-time":e.endTime,placeholder:"起始时间",start:"00:00",step:"00:15",end:"24:00",size:"default",editable:!1},null,8,["modelValue","onUpdate:modelValue","max-time"]),v("至 "),b(ye,{modelValue:e.endTime,"onUpdate:modelValue":a=>e.endTime=a,"min-time":e.startTime,placeholder:"结束时间",start:"00:00",step:"00:15",end:"24:00",size:"default",editable:!1},null,8,["modelValue","onUpdate:modelValue","min-time"])])),_:2},1024),b(m,{span:8},{default:h((()=>[b(n,{modelValue:e.chargeP,"onUpdate:modelValue":a=>e.chargeP=a,placeholder:"功率值",size:"default",autocomplete:"off"},{default:h((()=>[B])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)])])))),128)),i("div",H,[b(d,{class:"newpower-btn",size:"default",onClick:xe},{default:h((()=>[v("设置")])),_:1}),b(d,{class:"newpower-btn",size:"default",onClick:_e},{default:h((()=>[v("查看当前功率曲线")])),_:1})])])])),_:1})])),_:1}),b(m,{span:24},{default:h((()=>[i("div",J,[i("div",Q,[b(k,{chartseries:V.value},null,8,["chartseries"])])])])),_:1})])),_:1})])])}}}),[["__scopeId","data-v-91890e40"]]);export{X as default};
