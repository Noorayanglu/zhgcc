import{n as e,o as a}from"./user-26976d76.js";import{j as t}from"./index-5c157e93.js";import{f as l}from"./feedback-5363c0cc.js";import{i as r}from"./echarts-53b3fd57.js";import{_ as s}from"./index-9ec23aea.js";import{i as o,f as n,z as i,e as d,c as m,a as u,o as p,d as c,Z as f,ag as h,U as v,O as b,S as g,F as w,a7 as y,u as _,az as x,aA as j}from"./@vue-c5a747fc.js";import"./lodash-20cd73ca.js";import"./dayjs-9ee440cb.js";import"./axios-5b55c11d.js";import"./element-plus-230cec57.js";import"./lodash-es-fb3d0246.js";import"./@vueuse-90035fc5.js";import"./@element-plus-388117bf.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./escape-html-92a447fa.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-9ca8b935.js";import"./zrender-299a952d.js";import"./vue-router-641e505b.js";import"./pinia-801b3705.js";/* empty css                    */const T={class:"echarts-box"},V=s({__name:"setPower",props:{chartseries:{type:Array,default:[]}},setup(e){const a=e;o((()=>{s()})),n((()=>a.chartseries),(()=>{l&&l.dispose(),s()}),{deep:!0}),i((()=>{l&&l.dispose()}));const t=d();let l;function s(){l=r(t.value);const e={tooltip:{trigger:"axis",axisPointer:{type:"line"},backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgba(0,0,0,0.5)",textStyle:{color:"#fff"}},legend:{textStyle:{}},grid:{top:"20%",left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,axisTick:{show:!1},axisLabel:{},axisLine:{},data:""},yAxis:{type:"value",axisLine:{show:!0,lineStyle:{}},axisPointer:{type:"none"}},series:[{name:"功率曲线",type:"line",showSymbol:!1,data:a.chartseries}]};l.setOption(e)}return(e,a)=>(p(),m("div",T,[u("div",{ref_key:"myEcharts",ref:t,style:{width:"100%",height:"100%"}},null,512)]))}},[["__scopeId","data-v-7d0aeea7"]]),S=e=>(x("data-v-ad7fa245"),e=e(),j(),e),k={class:"setup"},P={class:"tab-box"},C=S((()=>u("div",{class:"card-header"},[u("span",null,"控制")],-1))),U={class:"newpower-box"},E={class:"newpower-box"},z=S((()=>u("div",{class:"card-header"},[u("span",null,"功率曲线设置")],-1))),I={class:"card-con"},A=S((()=>u("div",{class:"power-name"},"时间",-1))),L=S((()=>u("div",{class:"power-name power-text-margin"},"功率值（KW）",-1))),N={class:"setvalue-value"},O=S((()=>u("template",{slot:"append"},[g("KW")],-1))),D=["onClick"],F={class:"setpowerbtn"},G={class:"power-box"},K={class:"power-box-box"},M=s(c({__name:"Index",setup(r){const s=d([]),n=d({}),i=d([]),c=d([]),x=d([]),j=d(15);d("");let T=f([{chargeP:"",startTime:"",endTime:""}]);const S=d(),M=f({param:null}),R=d(),W=f({param:null});o((async()=>{c.value=await ee(j.value),await te()}));const Z=e=>{T.some((e=>""===e.chargeP||""===e.startTime||""===e.endTime))||B()},q=()=>{Y(c.value,i.value)},B=async()=>{J().then((e=>{e&&Y(c.value,Object.values(e))})).catch((e=>{}))},H=()=>{J().then((e=>{e&&Q(e)})).catch((e=>{}))},J=()=>new Promise(((e,a)=>{let t=T.map(((e,a)=>[e.startTime,e.endTime]));if(T.some((e=>""===e.chargeP||""===e.startTime||""===e.endTime)))return l.msgError("功率值与时间不能为空"),void a(new Error("功率值与时间不能为空"));if(oe(t))return l.msgError("时间段有重复"),void a(new Error("时间段有重复"));let r=re(T);r.forEach((e=>{"00:00"===e.endTime&&(e.endTime="24:00")})),e(le(r).reduce(((e,a,t)=>(e[t+1]=a.chargeP,e)),{}))})),Q=e=>{let t={cmd:2,...e};a(t).then((e=>{l.msgSuccess("设置成功"),te()})).catch((e=>{}))},X=()=>{T.push({chargeP:"",startTime:"",endTime:""})},Y=async(e,a)=>{let t=await $(e,a),l=t.map((e=>e.name)),r=t.map((e=>e.value));x.value=l.map(((e,a)=>[e,r[a]]))},$=(e,a)=>{const t=e.map(((e,t)=>({name:e,value:a[t]})));let l=[];return l.push(t[0]),t.reduce(((e,a)=>{let t=null;return e.value!==a.value&&(t={name:a.name,value:e.value}),t?l.push(t,a):l.push(a),a})),l},ee=e=>{let a=60*e,t=86400/a,l=0,r=[];for(let s=0;s<t;s++){let e=parseInt(l/3600),t=parseInt(l%3600/60);r.push(ae(e)+":"+ae(t)),l+=a}return r},ae=e=>e<10?"0"+e:e,te=()=>{e().then((e=>{let a=e;n.value={"充电截止电芯电压":a["充电截止电芯电压"],"放电截止电芯电压":a["放电截止电芯电压"],"数据记录状态":a["数据记录状态"]},s.value=t(n.value);const{"充电截止电芯电压":l,"放电截止电芯电压":r,"数据记录状态":o,...d}=a;i.value=Object.values(d),Y(c.value,i.value)})).catch((e=>{}))},le=e=>{let a=[];for(let t=0;t<1440;t+=15){const l="".concat(String(Math.floor(t/60)).padStart(2,"0"),":").concat(String(t%60).padStart(2,"0"));let r="0";for(const a of e){const e=se(a.startTime),l=se(a.endTime);if(t>=e&&t<l){r=a.chargeP;break}}a.push({time:l,chargeP:r})}return a},re=e=>(e.sort(((e,a)=>{const t=se(e.startTime),l=se(e.endTime),r=se(a.startTime),s=se(a.endTime);return t!==r?t-r:l-s})),e),se=e=>{const[a,t]=e.split(":").map(Number);return 60*a+t},oe=e=>{const a=new Set;for(const[t,l]of e)for(let e=t;e<l;e=ne(e,1)){if(a.has(e))return!0;a.add(e)}return!1},ne=(e,a)=>{const[t,l]=e.split(":").map(Number);let r=t+Math.floor((l+a)/60),s=(l+a)%60;return 60===s&&(s=0,r+=1),"".concat(String(r).padStart(2,"0"),":").concat(String(s).padStart(2,"0"))};return(e,t)=>{const r=h("el-table-column"),o=h("el-table"),n=h("el-input"),i=h("el-button"),d=h("el-form-item"),c=h("el-form"),f=h("el-card"),j=h("el-col"),B=h("el-row"),J=h("el-time-select"),Q=h("Delete"),Y=h("el-icon"),$=h("Plus");return p(),m("div",k,[u("div",null,[v(B,null,{default:b((()=>[v(j,{span:12,class:"col-box"},{default:b((()=>[u("div",P,[v(o,{data:s.value,stripe:"",border:"",align:"center",style:{width:"100%"}},{default:b((()=>[v(r,{type:"index",width:"60",align:"center",label:"序号"}),v(r,{prop:"name",label:"数据名称",align:"center"}),v(r,{prop:"value",label:"数值",align:"center"}),v(r,{prop:"unit",label:"单位",align:"center",width:"60"})])),_:1},8,["data"])]),v(f,{class:"box-card"},{header:b((()=>[C])),default:b((()=>[u("div",null,[v(c,{ref_key:"formRef",ref:S,model:M},{default:b((()=>[v(d,{label:"充电截至电芯电压",prop:"param"},{default:b((()=>[u("div",U,[v(n,{modelValue:M.param,"onUpdate:modelValue":t[0]||(t[0]=e=>M.param=e),type:"number",class:"newpower-input"},null,8,["modelValue"]),v(i,{class:"newpower-btn",type:"primary",onClick:t[1]||(t[1]=e=>(e=>{if(!e)return;if(null===M.param)return void l.msgError("请输入充电截至电芯电压");let t={cmd:0,param:1e3*Number(M.param)};a(t).then((e=>{l.msgSuccess("设置成功"),te()})).catch((e=>{}))})(S.value))},{default:b((()=>[g("设置")])),_:1})])])),_:1})])),_:1},8,["model"]),v(c,{ref_key:"formRef1",ref:R,model:W},{default:b((()=>[v(d,{label:"放电截至电芯电压",prop:"param"},{default:b((()=>[u("div",E,[v(n,{modelValue:W.param,"onUpdate:modelValue":t[2]||(t[2]=e=>W.param=e),type:"number",class:"newpower-input"},null,8,["modelValue"]),v(i,{class:"newpower-btn",type:"primary",onClick:t[3]||(t[3]=e=>(e=>{if(!e)return;if(null===W.param)return void l.msgError("请输入放电截至电芯电压");let t={cmd:1,param:1e3*Number(W.param)};a(t).then((e=>{l.msgSuccess("设置成功"),te()})).catch((e=>{}))})(R.value))},{default:b((()=>[g("设置")])),_:1})])])),_:1})])),_:1},8,["model"])])])),_:1})])),_:1}),v(j,{span:12},{default:b((()=>[v(f,{class:"box-card"},{header:b((()=>[z])),default:b((()=>[u("div",I,[v(B,null,{default:b((()=>[v(j,{span:14},{default:b((()=>[A])),_:1}),v(j,{span:8},{default:b((()=>[L])),_:1})])),_:1}),(p(!0),m(w,null,y(_(T),((e,a)=>(p(),m("div",{key:a},[u("div",N,[v(B,null,{default:b((()=>[v(j,{span:14,class:"col-box-time"},{default:b((()=>[v(J,{modelValue:e.startTime,"onUpdate:modelValue":a=>e.startTime=a,"max-time":e.endTime,placeholder:"起始时间",start:"00:00",step:"00:15",end:"24:00",onChange:Z},null,8,["modelValue","onUpdate:modelValue","max-time"]),g("至 "),v(J,{modelValue:e.endTime,"onUpdate:modelValue":a=>e.endTime=a,"min-time":e.startTime,placeholder:"结束时间",start:"00:00",step:"00:15",end:"24:00",onChange:Z},null,8,["modelValue","onUpdate:modelValue","min-time"])])),_:2},1024),v(j,{span:8},{default:b((()=>[v(n,{modelValue:e.chargeP,"onUpdate:modelValue":a=>e.chargeP=a,placeholder:"功率值",autocomplete:"off",onChange:Z},{default:b((()=>[O])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024),v(j,{span:2},{default:b((()=>[u("div",{class:"del-btn",onClick:e=>(e=>{T.splice(e,1)})(a)},[v(Y,null,{default:b((()=>[v(Q)])),_:1})],8,D)])),_:2},1024)])),_:2},1024)])])))),128)),u("div",null,[u("div",{class:"add-btn",onClick:X},[v(Y,null,{default:b((()=>[v($)])),_:1}),g(" 新增 ")])]),u("div",F,[v(i,{class:"newpower-btn",type:"primary",onClick:H},{default:b((()=>[g("设置")])),_:1}),v(i,{class:"newpower-btn",type:"primary",onClick:q},{default:b((()=>[g("查看当前功率曲线")])),_:1})])])])),_:1})])),_:1})])),_:1})]),u("div",G,[u("div",K,[v(V,{chartseries:x.value},null,8,["chartseries"])])])])}}}),[["__scopeId","data-v-ad7fa245"]]);export{M as default};
